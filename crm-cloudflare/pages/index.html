<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM on Cloudflare</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div>
        <h1>Customer Relationship Manager</h1>
        <p id="pageHint">Company list</p>
      </div>
      <div class="top-actions">
        <button id="backBtn" class="ghost hidden" type="button">Back</button>
        <button id="manageRepsBtn" class="hidden" type="button">Manage Reps</button>
        <span id="whoami" class="whoami hidden"></span>
        <button id="logoutBtn" class="hidden" type="button">Log out</button>
      </div>
    </header>

    <main>
      <section id="authView" class="panel">
        <h2>Access</h2>
        <div class="split">
          <form id="bootstrapForm" class="card">
            <h3>Initial Admin Setup</h3>
            <label>Email <input name="email" type="email" required /></label>
            <label>Full name <input name="fullName" required /></label>
            <label>Password <input name="password" type="password" required /></label>
            <button type="submit">Create first admin</button>
          </form>

          <form id="loginForm" class="card">
            <h3>Log in</h3>
            <label>Email <input name="email" type="email" required /></label>
            <label>Password <input name="password" type="password" required /></label>
            <button type="submit">Sign in</button>
          </form>
        </div>
      </section>

      <section id="companyListView" class="panel hidden">
        <div class="row between">
          <h2>Companies</h2>
          <button id="showCreateCompanyBtn" type="button">Add Company</button>
        </div>
        <div class="row">
          <input id="companySearch" class="search" placeholder="Search by company, city, or state" />
        </div>
        <div id="noCompanyMatch" class="empty hidden">
          <p>No matching companies found.</p>
          <button id="quickAddCompanyBtn" type="button">Add New Company</button>
        </div>

        <form id="createCompanyForm" class="card hidden form-grid">
          <h3>New Company</h3>
          <label>Name <input name="name" required /></label>
          <label>Main phone <input name="mainPhone" /></label>
          <label class="full">Street <textarea name="address" rows="3"></textarea></label>
          <label>City <input name="city" /></label>
          <label>Country <select name="country" id="createCompanyCountry"></select></label>
          <label id="createCompanyStateWrap">State <input name="state" /></label>
          <label>Postal Code <input name="zip" /></label>
          <label>URL <input name="url" type="url" /></label>
          <label>Segment <select name="segment" id="createCompanySegment"></select></label>
          <label>Type <select name="customerType" id="createCompanyType"></select></label>
          <label class="full">Notes <textarea name="notes"></textarea></label>
          <button type="submit">Create</button>
        </form>

        <table>
          <thead>
            <tr>
              <th>Company</th>
              <th>City</th>
              <th>State</th>
            </tr>
          </thead>
          <tbody id="companiesBody"></tbody>
        </table>
      </section>

      <section id="companyDetailView" class="hidden">
        <details open class="panel">
          <summary>Main Company Information</summary>
          <form id="companyEditForm" class="form-grid"></form>
        </details>

        <details open class="panel">
          <summary>Contacts</summary>
          <div class="row between">
            <p class="muted">Click a contact row to open details.</p>
            <button id="newContactBtn" type="button">New Contact</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
              </tr>
            </thead>
            <tbody id="contactsBody"></tbody>
          </table>
        </details>

        <details open class="panel">
          <summary>Interactions (Newest First)</summary>
          <div class="row between">
            <p class="muted">Click an interaction row to open details.</p>
            <button id="newInteractionBtn" type="button">New Interaction</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Rep</th>
                <th>Type</th>
                <th>Notes</th>
                <th>Next action</th>
              </tr>
            </thead>
            <tbody id="interactionsBody"></tbody>
          </table>
        </details>
      </section>

      <section id="contactDetailView" class="panel hidden">
        <h2>Contact Detail</h2>
        <form id="contactEditForm" class="form-grid"></form>
      </section>

      <section id="contactCreateView" class="panel hidden">
        <h2>New Contact</h2>
        <form id="contactCreateForm" class="form-grid"></form>
      </section>

      <section id="interactionDetailView" class="panel hidden">
        <h2>Interaction Detail</h2>
        <form id="interactionEditForm" class="form-grid"></form>
      </section>

      <section id="interactionCreateView" class="panel hidden">
        <h2>New Interaction</h2>
        <form id="interactionCreateForm" class="form-grid"></form>
      </section>

      <section id="repsView" class="panel hidden">
        <div class="row between">
          <h2>Reps and Assigned Companies</h2>
        </div>

        <form id="repCreateForm" class="row wrap"></form>
        <form id="repAssignmentForm" class="row wrap"></form>

        <table>
          <thead>
            <tr>
              <th>Rep</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Assigned companies</th>
              <th>Territories</th>
            </tr>
          </thead>
          <tbody id="repsBody"></tbody>
        </table>

        <div class="card">
          <h3>Assign Territory</h3>
          <form id="territoryForm" class="row wrap"></form>
          <ul id="territoryList" class="list"></ul>
        </div>

        <div class="card">
          <h3>Company Dropdown Values</h3>
          <div class="split">
            <form id="segmentValueForm" class="row wrap"></form>
            <form id="typeValueForm" class="row wrap"></form>
          </div>
        </div>
      </section>
    </main>

    <aside id="toast" class="toast hidden"></aside>

    <script>
      window.CRM_API_BASE = "https://crm-api.gdeharo.workers.dev";
    </script>
    <script src="./app.js" defer></script>
  </body>
</html>
