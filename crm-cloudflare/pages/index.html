<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM on Cloudflare</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div>
        <h1>Customer Relationship Manager</h1>
        <p>Cloudflare Pages + Workers + D1 + R2</p>
      </div>
      <div id="sessionInfo" class="session-info hidden">
        <span id="whoami"></span>
        <button id="logoutBtn" type="button">Log out</button>
      </div>
    </header>

    <main>
      <section id="authPanel" class="panel">
        <h2>Access</h2>
        <div class="split">
          <form id="bootstrapForm" class="card">
            <h3>Initial Admin Setup</h3>
            <label>Email <input name="email" type="email" required /></label>
            <label>Full name <input name="fullName" required /></label>
            <label>Password <input name="password" type="password" required /></label>
            <button type="submit">Create first admin</button>
          </form>

          <form id="loginForm" class="card">
            <h3>Log in</h3>
            <label>Email <input name="email" type="email" required /></label>
            <label>Password <input name="password" type="password" required /></label>
            <button type="submit">Sign in</button>
          </form>
        </div>
      </section>

      <section id="appPanel" class="hidden">
        <div class="panel">
          <h2>Company Contact Lookup</h2>
          <div class="row">
            <select id="companyLookupSelect"></select>
            <button id="loadCompanyContactsBtn" type="button">Show company contacts</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>First name</th>
                <th>Last name</th>
                <th>Email</th>
                <th>Phone</th>
              </tr>
            </thead>
            <tbody id="companyContactsBody"></tbody>
          </table>
        </div>

        <section class="grid">
          <div class="panel">
            <h2>Companies</h2>
            <form id="companyForm" class="stack">
              <label>Name <input name="name" required /></label>
              <label>Address <input name="address" /></label>
              <label>Contact name <input name="contactName" /></label>
              <label>Contact email <input name="contactEmail" type="email" /></label>
              <label>Contact phone <input name="contactPhone" /></label>
              <label>URL <input name="url" type="url" /></label>
              <label>Segment <input name="segment" /></label>
              <label>Customer type <input name="customerType" /></label>
              <label>Notes <textarea name="notes"></textarea></label>
              <label>Assigned reps
                <select id="companyRepIds" multiple></select>
              </label>
              <button type="submit">Create company</button>
            </form>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Segment</th>
                  <th>Type</th>
                  <th>Customers</th>
                  <th>Reps</th>
                </tr>
              </thead>
              <tbody id="companiesBody"></tbody>
            </table>
            <div class="upload-row">
              <select id="companyFileEntity"></select>
              <input id="companyFileInput" type="file" />
              <button id="uploadCompanyFileBtn" type="button">Upload company document</button>
            </div>
            <ul id="companyAttachments" class="attachments"></ul>
          </div>

          <div class="panel">
            <h2>Customers</h2>
            <form id="customerForm" class="stack">
              <label>Company
                <select name="companyId" id="customerCompanyId" required></select>
              </label>
              <label>First name <input name="firstName" required /></label>
              <label>Last name <input name="lastName" required /></label>
              <label>Email <input name="email" type="email" /></label>
              <label>Phone <input name="phone" /></label>
              <label>Notes <textarea name="notes"></textarea></label>
              <label>Assigned reps
                <select id="customerRepIds" multiple></select>
              </label>
              <button type="submit">Create customer</button>
            </form>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Company</th>
                  <th>Email</th>
                  <th>Phone</th>
                </tr>
              </thead>
              <tbody id="customersBody"></tbody>
            </table>
            <div class="upload-row">
              <select id="customerFileEntity"></select>
              <input id="customerFileInput" type="file" accept="image/*,.pdf,.jpg,.jpeg,.png" />
              <button id="uploadCustomerFileBtn" type="button">Upload customer file/photo</button>
            </div>
            <ul id="customerAttachments" class="attachments"></ul>
          </div>

          <div class="panel">
            <h2>Sales Reps</h2>
            <form id="repForm" class="stack">
              <label>Full name <input name="fullName" required /></label>
              <label>Company <input name="companyName" /></label>
              <label>Email <input name="email" type="email" /></label>
              <label>Phone <input name="phone" /></label>
              <label>Segment <input name="segment" /></label>
              <label>Customer type <input name="customerType" /></label>
              <label>
                <input name="isIndependent" type="checkbox" /> Independent rep
              </label>
              <button type="submit">Create rep</button>
            </form>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Company</th>
                  <th>Email</th>
                  <th>Phone</th>
                </tr>
              </thead>
              <tbody id="repsBody"></tbody>
            </table>
          </div>

          <div class="panel">
            <h2>Interactions</h2>
            <form id="interactionForm" class="stack">
              <label>Company
                <select name="companyId" id="interactionCompanyId" required></select>
              </label>
              <label>Customer
                <select name="customerId" id="interactionCustomerId"></select>
              </label>
              <label>Rep
                <select name="repId" id="interactionRepId"></select>
              </label>
              <label>Type <input name="interactionType" placeholder="Call, meeting, email" /></label>
              <label>Meeting notes <textarea name="meetingNotes" required></textarea></label>
              <label>Next action <input name="nextAction" /></label>
              <label>Next action date/time <input name="nextActionAt" type="datetime-local" /></label>
              <button type="submit">Log interaction</button>
            </form>
            <table>
              <thead>
                <tr>
                  <th>Company</th>
                  <th>Customer</th>
                  <th>Rep</th>
                  <th>Notes</th>
                  <th>Next action</th>
                </tr>
              </thead>
              <tbody id="interactionsBody"></tbody>
            </table>
            <div class="upload-row">
              <select id="interactionFileEntity"></select>
              <input id="interactionFileInput" type="file" />
              <button id="uploadInteractionFileBtn" type="button">Upload interaction file</button>
            </div>
            <ul id="interactionAttachments" class="attachments"></ul>
          </div>
        </section>

        <section id="adminPanel" class="panel hidden">
          <h2>User and Role Management (Admin)</h2>
          <form id="userForm" class="row wrap">
            <input name="email" type="email" placeholder="email" required />
            <input name="fullName" placeholder="full name" required />
            <select name="role" required>
              <option value="admin">admin</option>
              <option value="manager">manager</option>
              <option value="rep">rep</option>
              <option value="viewer">viewer</option>
            </select>
            <input name="password" type="password" placeholder="temporary password" required />
            <button type="submit">Create user</button>
          </form>
          <table>
            <thead>
              <tr>
                <th>Email</th>
                <th>Name</th>
                <th>Role</th>
                <th>Active</th>
              </tr>
            </thead>
            <tbody id="usersBody"></tbody>
          </table>
        </section>
      </section>
    </main>

    <aside id="toast" class="toast hidden"></aside>

    <script>
      window.CRM_API_BASE = "https://crm-api.gdeharo.workers.dev";
    </script>
    <script src="./app.js" defer></script>
  </body>
</html>
